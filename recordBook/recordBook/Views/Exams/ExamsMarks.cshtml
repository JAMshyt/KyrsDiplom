@using recordBook.Models
@using recordBook.Models.ViewModels

@model Exams
@{
	ViewData["Title"] = "Студенты групы " + Model.selectedGroup.Name_group;
}

<h1>@ViewData["Title"]</h1>

<form asp-controller="Exams" asp-action="ExamsMarks">
	<select name="selectedGroup" required onchange="this.form.submit()" style="width:120px; height:40px; text-align:center">
		@foreach (var groups in Model.Groups)
		{
			if (groups.ID_Group == Model.selectedGroup.ID_Group)
			{
				<option value="@groups.ID_Group" selected>@groups.Name_group</option>
			}
			else
			{
				<option value="@groups.ID_Group">@groups.Name_group</option>
			}
		}
	</select>

	<select name="selectedSubject" required onchange="this.form.submit()" style="width:200px; height:40px; text-align:center">
		@foreach (var subj in Model.Subjects)
		{
			if (Model.Group_Subjects.Where(y => y.ID_Group == Model.selectedGroup.ID_Group).Select(z => z.ID_Subject).Contains(subj.ID_Subject))
			{
				if (subj.ID_Subject == Model.selectedSubject.ID_Subject)
				{
					<option value="@subj.ID_Subject" selected>@subj.Name_subject</option>
				}
				else
				{
					<option value="@subj.ID_Subject">@subj.Name_subject</option>
				}
			}
		}
	</select>
</form>

<table class="table" id="myTable" style="width:95%">

	<thead>
		<tr>
			<th id="tableLabel">
				<h6 style="margin-bottom : 0px; text-align:center;">Студент</h6>
			</th>
			<th id="tableLabel">
				<h6 style="margin-bottom : 0px; text-align:center; display:inline">Оценка</h6>
				<button type="button" id="ChangeGrade" class="btn btn-warning">Изменить</button>
			</th>
			<th id="tableLabel">
				<h6 style="margin-bottom : 0px; text-align:center">Тип работы</h6>
			</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var item in Model.Students.Where(z => z.ID_Group == Model.selectedGroup.ID_Group))
		{
			//var data = item.Date.ToString("dd MMMM yyyy");
			<tr id="columnGrade">
				<td style="text-align:center; font-weight: bold">
					<p id="label_s">@item.Surname  @item.Name  @item.Patronymic</p>
				</td>
				@foreach (var r in Model.Academic_Performances.Where(z => z.ID_Student == item.ID_Student).Where(y => y.ID_Subject == Model.selectedSubject.ID_Subject))
				{
					<td id="cellGrade" style="text-align:center;  padding-right:20%; font-weight: bold ">
						<p class="labelsGrade">@r.Grade</p>
						<select class="selectGrades" style="width:200px; height:30px; text-align:center">
							<option>Отлично</option>
							<option>Хорошо</option>
							<option>Удовлетворительно</option>
							<option>Не удовлетворительно</option>
							<option selected>-</option>
						</select>
					</td>

					<td style="text-align:center;  font-weight: bold ">
						<p id="label_s"> @Model.Kind_of_works.Where(z => z.ID_Kind_of_work == @r.ID_Kind_of_work).Select(z => z.Title_of_kind).FirstOrDefault() </p>
					</td>
				}
			</tr>
		}
	</tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type='text/javascript'>

	$(document).ready(function () {
		$('.selectGrades').hide();

	});

	$('#ChangeGrade').click(function () {
		var url = "/Exams/ChangeGrades";
		$.ajax({
			url: url,
			method: 'GET',
			dataType: 'json',
			success: function (product) {
				console.log(product);
			},
		});

		if ($(".labelsGrade").is(':visible')) {
			$('.labelsGrade').hide();
			$('.selectGrades').show();
			$('#ChangeGrade').text('Сохранить');
		}
		else {
			$('.labelsGrade').show();
			$('.selectGrades').hide();
			$('#ChangeGrade').text('Изменить');
			console.log('shit');
		}

	});

</script>